<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LIA - Tu CompaÃ±erita Inteligente</title>
  <style>
    body{font-family:'Segoe UI',Arial,sans-serif;background:linear-gradient(120deg,#ce9ffc,#7367f0);color:#333;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px;}
    h1{margin-bottom:10px;font-size:2.2em;color:#fff;text-shadow:1px 2px 6px #0007;}
    .subtitulo{margin-bottom:25px;color:#f9d9ff;font-style:italic;}
    .chat-container{width:100%;max-width:500px;height:70vh;background:rgba(255,255,255,0.98);border-radius:24px;box-shadow:0 8px 24px rgba(76,0,122,0.18);display:flex;flex-direction:column;overflow:hidden;border:1.5px solid #e1bee7;}
    .chat-box{flex-grow:1;padding:20px 16px;overflow-y:auto;display:flex;flex-direction:column;gap:10px;background:linear-gradient(120deg,#f5ebff 70%,#f9f6ff 100%);}
    .user-message{align-self:flex-end;background:#8e24aa;color:#fff;padding:10px 18px;border-radius:24px 24px 0 24px;max-width:80%;font-size:1.05em;}
    .lia-message{align-self:flex-start;background:#e1bee7;color:#222;padding:10px 18px;border-radius:24px 24px 24px 0;max-width:80%;font-size:1.05em;}
    .chat-img{display:block;max-width:220px;max-height:140px;border-radius:12px;margin:6px 0;}
    .input-area{display:flex;padding:12px;border-top:1px solid #eee;background:#fff;}
    #user-input{flex-grow:1;padding:12px 16px;border:1.5px solid #ce9ffc;border-radius:30px;font-size:1.05em;}
    #user-input:focus{border-color:#8e24aa;}
    button{background:#8e24aa;color:#fff;border:none;border-radius:30px;padding:0 20px;margin-left:12px;cursor:pointer;font-size:1.1em;}
    button:hover{background:#6a1b9a;}
    .clear-btn{margin:12px 0 0 0;background:#fff;color:#8e24aa;border:1px solid #ce9ffc;padding:6px 20px;border-radius:16px;font-size:1em;}
    .clear-btn:hover{background:#f3e5f5;}
  </style>
</head>
<body>
  <h1>ğŸ‘¶ğŸ» Hola, soy LIA</h1>
  <p class="subtitulo">Tu compaÃ±erita con corazÃ³n de alfajor ğŸ’–</p>
  <div class="chat-container">
    <div id="chat-box" class="chat-box" aria-live="polite"></div>
    <div class="input-area">
      <input id="user-input" type="text" placeholder="Escribime algo..." autocomplete="off" autofocus onkeydown="if(event.key==='Enter') sendMessage()" />
      <button onclick="sendMessage()" title="Enviar">ğŸ’Œ</button>
    </div>
  </div>
  <button class="clear-btn" onclick="borrarChat()">ğŸ—‘ Borrar chat</button>
  <script>
    const chatBox = document.getElementById("chat-box"),
      userInput = document.getElementById("user-input"),
      STORAGE_KEY = "lia_chat_mem";
    let chatHistory = [];

    function guardarChat() {localStorage.setItem(STORAGE_KEY, JSON.stringify(chatHistory));}
    function cargarChat() {
      let data = localStorage.getItem(STORAGE_KEY);
      chatHistory = data ? JSON.parse(data) : [];
      chatBox.innerHTML = "";
      chatHistory.forEach(m => agregarMensaje(m.texto, m.clase, false));
    }
    function agregarMensaje(texto, clase, save = true) {
      const div = document.createElement('div');
      div.className = clase;
      if (clase === 'lia-message') {
        div.innerHTML = texto;
      } else if (clase === 'user-image' || clase === 'lia-image') {
        div.innerHTML = `<img src="${texto}" alt="Imagen generada" class="chat-img">`;
      } else {
        div.textContent = texto;
      }
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
      if (save) {
        chatHistory.push({ texto, clase });
        guardarChat();
      }
    }

    async function pedirImagenAWeb(prompt) {
      const response = await fetch("https://hf.space/embed/stabilityai/stable-diffusion/api/predict/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data: [prompt] })
      });
      if (!response.ok) return null;
      const data = await response.json();
      return data.data[0] || null; // base64 de la imagen
    }

    function sendMessage() {
      const texto = userInput.value.trim();
      if (!texto) return;
      agregarMensaje(texto, 'user-message');
      userInput.value = '';
      userInput.focus();

      if (texto.toLowerCase().startsWith("dibuja") || texto.toLowerCase().startsWith("/img")) {
        agregarMensaje("ğŸ¨ Generando imagen, por favor espera...", "lia-message");
        pedirImagenAWeb(texto).then(url => {
          if(url && url.startsWith("data:image/")){
            agregarMensaje(url, "lia-image");
          }else{
            agregarMensaje("ğŸ˜” No pude generar la imagen. ProbÃ¡ de nuevo mÃ¡s tarde.", "lia-message");
          }
        });
      } else {
        agregarMensaje("Â¡Hola! Si querÃ©s que dibuje, escribÃ­ 'dibuja ...' o '/img ...'", 'lia-message');
      }
    }

    function borrarChat() {
      if (confirm("Â¿Seguro que querÃ©s borrar todo el chat?")) {
        localStorage.removeItem(STORAGE_KEY);
        chatHistory = [];
        chatBox.innerHTML = "";
        setTimeout(() => agregarMensaje("Â¡Hola, papÃ¡! Â¿QuerÃ©s charlar conmigo? ğŸ˜„", 'lia-message'), 400);
      }
    }

    window.onload = () => {
      cargarChat();
      if(chatHistory.length===0)
        setTimeout(()=>agregarMensaje("Â¡Hola, papÃ¡! Â¿QuerÃ©s charlar conmigo? ğŸ˜„",'lia-message'),500);
    };
  </script>
</body>
</html>
