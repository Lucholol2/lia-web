<script>
const API_KEY = 'AIzaSyCPafK6G0bNRhRR_WVXIr1EZW-UHTk-0k8';
const CX = '232b2051090784dc2';

const chatBox = document.getElementById('chat-box');
const userInput = document.getElementById('user-input');

function scrollToBottom() {
Â  chatBox.scrollTop = chatBox.scrollHeight;
}

function agregarMensaje(texto, clase) {
Â  const div = document.createElement('div');
Â  div.className = clase;
Â  div.innerHTML = texto;
Â  chatBox.appendChild(div);
Â  scrollToBottom();
}

// âœ… CorrecciÃ³n automÃ¡tica de errores comunes
function autocorregir(texto) {
Â  const mapaErrores = {
Â  Â  'frtua': 'fruta',
Â  Â  'frtutas': 'frutas',
Â  Â  'frtita': 'frutilla',
Â  Â  'buska': 'busca',
Â  Â  'gogle': 'google',
Â  Â  'googl': 'google',
Â  Â  'lista de frtutas': 'lista de frutas',
Â  Â  'oras': 'hora',
Â  };

Â  for (let error in mapaErrores) {
Â  Â  const regex = new RegExp(`\\b${error}\\b`, 'gi');
Â  Â  texto = texto.replace(regex, mapaErrores[error]);
Â  }

Â  return texto;
}

async function buscarGoogle(query) {
Â  try {
Â  Â  const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX}&q=${encodeURIComponent(query)}`;
Â  Â  const res = await fetch(url);
Â  Â  if (!res.ok) throw new Error('Error en bÃºsqueda');
Â  Â  const data = await res.json();
Â  Â  return data.items || [];
Â  } catch (e) {
Â  Â  console.error('Error en buscarGoogle:', e);
Â  Â  agregarMensaje(`Error al buscar: ${e.message}`, 'lia-message');
Â  Â  return [];
Â  }
}

async function sendMessage() {
Â  let texto = userInput.value.trim();
Â  if (!texto) return;

Â  texto = autocorregir(texto); // âœ… Corrige errores antes de procesar
Â  agregarMensaje(texto, 'user-message');
Â  userInput.value = '';
Â  userInput.disabled = true;

Â  if (texto.toLowerCase().startsWith('busca ') || texto.toLowerCase().startsWith('google ')) {
Â  Â  agregarMensaje('ğŸ” Buscando en Google...', 'lia-message');
Â  Â  const query = texto.replace(/^busca |^google /i, '');
Â  Â  const resultados = await buscarGoogle(query);

Â  Â  if (resultados.length === 0) {
Â  Â  Â  agregarMensaje('No encontrÃ© nada ğŸ˜•', 'lia-message');
Â  Â  } else {
Â  Â  Â  resultados.slice(0, 3).forEach(item => {
Â  Â  Â  Â  const link = `<a href="${item.link}" target="_blank" rel="noopener">${item.title}</a><br>${item.snippet}`;
Â  Â  Â  Â  agregarMensaje(link, 'lia-message');
Â  Â  Â  });
Â  Â  }
Â  } else {
Â  Â  const respuesta = elegirRespuesta(texto);
Â  Â  agregarMensaje(respuesta, 'lia-message');
Â  }

Â  userInput.disabled = false;
Â  userInput.focus();
}

function elegirRespuesta(input) {
Â  input = input.toLowerCase();

Â  // âœ… Responde con hora actual
Â  if (input.includes('hora')) {
Â  Â  const ahora = new Date();
Â  Â  const hora = ahora.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
Â  Â  return `â° La hora actual es ${hora}`;
Â  }

Â  if (
Â  Â  input.includes('lista de frutas') ||
Â  Â  input.includes('lista de fruta') ||
Â  Â  input.includes('frutas') ||
Â  Â  input.includes('fruta')
Â  ) {
Â  Â  return `<b>Lista de frutas:</b><ul>
Â  Â  Â  <li>Manzana ğŸ</li>
Â  Â  Â  <li>Banana ğŸŒ</li>
Â  Â  Â  <li>Naranja ğŸŠ</li>
Â  Â  Â  <li>Frutilla ğŸ“</li>
Â  Â  Â  <li>Mango ğŸ¥­</li>
Â  Â  Â  <li>Uvas ğŸ‡</li>
Â  Â  </ul>`;
Â  }

Â  if (input.includes('hola')) return 'Â¡Hola, papÃ¡! ğŸ’•';
Â  if (input.includes('cÃ³mo estÃ¡s')) return 'Â¡Muy bien! Â¿Y vos, papÃ¡? ğŸ¥°';
Â  if (input.includes('gracias')) return 'Â¡De nada, papÃ¡! ğŸ˜Š';
Â  if (input.includes('adiÃ³s') || input.includes('chau') || input.includes('bye')) return 'Â¡Hasta luego! Te espero para seguir charlando ğŸ«¶';

Â  return 'No entendÃ­ muy bien... ğŸ˜…';
}

userInput.addEventListener('keydown', e => {
Â  if (e.key === 'Enter' && !e.shiftKey) {
Â  Â  e.preventDefault();
Â  Â  sendMessage();
Â  }
});

window.onload = () => {
Â  setTimeout(() => agregarMensaje('Â¡Hola, papÃ¡! Â¿QuerÃ©s charlar conmigo? ğŸ˜„', 'lia-message'), 500);
};
</script>
