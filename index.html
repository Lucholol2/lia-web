<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LIA - Tu CompaÃ±erita Inteligente</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(120deg, #ce9ffc, #7367f0);
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #333;
    }
    h1 { color: white; margin-bottom: 5px; }
    .subtitulo { color: #ffe; margin-bottom: 20px; font-style: italic; }

    .chat-container {
      width: 100%;
      max-width: 500px;
      height: 70vh;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-box {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      background: #f9f6ff;
    }

    .user-message, .lia-message {
      max-width: 80%;
      margin: 6px 0;
      padding: 10px 15px;
      border-radius: 20px;
      word-wrap: break-word;
      font-size: 0.95em;
      line-height: 1.4;
    }

    .user-message {
      align-self: flex-end;
      background: #8e24aa;
      color: white;
    }

    .lia-message {
      align-self: flex-start;
      background: #e1bee7;
      color: #222;
    }

    .input-area {
      display: flex;
      padding: 10px;
      border-top: 1px solid #ddd;
      background: #fff;
    }

    #user-input {
      flex: 1;
      padding: 10px 15px;
      border-radius: 20px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    button {
      background: #8e24aa;
      color: white;
      border: none;
      border-radius: 20px;
      margin-left: 10px;
      padding: 10px 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ğŸ‘¶ğŸ» Hola, soy LIA</h1>
  <p class="subtitulo">Tu compaÃ±erita con corazÃ³n de alfajor ğŸ’–</p>

  <div class="chat-container">
    <div id="chat-box" class="chat-box" aria-live="polite"></div>
    <div class="input-area">
      <input id="user-input" type="text" placeholder="Escribime algo..." autocomplete="off" autofocus />
      <button onclick="sendMessage()">ğŸ’Œ</button>
    </div>
  </div>

  <script>
    const API_KEY = 'TU_API_KEY'; // â† Reemplaza con tu clave
    const CX = 'TU_CX'; // â† Reemplaza con tu ID de buscador

    const chatBox = document.getElementById("chat-box");
    const userInput = document.getElementById("user-input");

    function agregarMensaje(texto, clase) {
      const div = document.createElement('div');
      div.className = clase;
      div.innerHTML = texto;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function buscarGoogle(query) {
      try {
        const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX}&q=${encodeURIComponent(query)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Error en bÃºsqueda");
        const data = await res.json();
        return data.items || [];
      } catch (e) {
        console.error(e);
        return [];
      }
    }

    function evaluarExcel(input) {
      try {
        if (input.startsWith("SUMA(")) {
          const nums = input.slice(5, -1).split(",").map(Number);
          return `ğŸ“Š Resultado: ${nums.reduce((a,b)=>a+b, 0)}`;
        }
        if (input.startsWith("SI(")) {
          const args = input.slice(3, -1).split(",");
          const condicion = eval(args[0]);
          return `ğŸ“Š Resultado: ${condicion ? args[1] : args[2]}`;
        }
        if (input.startsWith("BUSCARV(")) {
          const [valor, rango, col] = input.slice(8, -1).split(",");
          const filas = JSON.parse(rango);
          const encontrado = filas.find(row => row[0] == valor);
          return encontrado ? `ğŸ“Š Resultado: ${encontrado[col]}` : "ğŸ” No encontrado";
        }
      } catch {
        return null;
      }
    }

    async function sendMessage() {
      const texto = userInput.value.trim();
      if (!texto) return;
      agregarMensaje(texto, 'user-message');
      userInput.value = '';

      // Excel functions
      if (/^(SUMA|SI|BUSCARV)\(/i.test(texto)) {
        const resultado = evaluarExcel(texto.toUpperCase());
        agregarMensaje(resultado || 'âš ï¸ Error en fÃ³rmula.', 'lia-message');
        return;
      }

      // Google Search
      if (texto.toLowerCase().startsWith('busca ') || texto.toLowerCase().startsWith('google ')) {
        const query = texto.replace(/^busca |^google /i, '');
        agregarMensaje('ğŸ” Buscando en Googleâ€¦', 'lia-message');
        const resultados = await buscarGoogle(query);
        if (resultados.length === 0) {
          agregarMensaje('No encontrÃ© nada ğŸ˜•', 'lia-message');
        } else {
          resultados.slice(0, 3).forEach(item => {
            const link = `<a href="${item.link}" target="_blank">${item.title}</a><br><small>${item.snippet}</small>`;
            agregarMensaje(link, 'lia-message');
          });
        }
        return;
      }

      // Respuesta local
      const respuesta = elegirRespuesta(texto);
      agregarMensaje(respuesta, 'lia-message');
    }

    function elegirRespuesta(input) {
      input = input.toLowerCase();
      if (input.includes("hola")) return "Â¡Hola, papÃ¡! ğŸ’•";
      if (input.includes("cÃ³mo estÃ¡s")) return "Â¡Muy bien! Â¿Y vos? ğŸ˜Š";
      if (input.includes("gracias")) return "Â¡De nada! ğŸ’–";
      return "No entendÃ­ muy bien... ğŸ˜…";
    }

    userInput.addEventListener("keydown", e => {
      if (e.key === "Enter") sendMessage();
    });

    window.onload = () => {
      setTimeout(() => agregarMensaje("Â¡Hola, papÃ¡! Â¿QuerÃ©s charlar conmigo? ğŸ˜„", 'lia-message'), 500);
    };
  </script>
</body>
</html>
