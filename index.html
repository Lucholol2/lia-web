<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chat con Aprendizaje Local - Lia</title>
<style>
  body, input, button {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  body {
    margin: 20px;
    background: linear-gradient(120deg, #f3e5f5 0%, #e1bee7 100%);
    color: #2a1432;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 5px 2px;
    user-select: none;
  }
  h1 {
    margin-bottom: 7px;
    font-size: 1.3em;
    color: #8e24aa;
    font-weight: 700;
    letter-spacing: 0.03em;
    text-shadow: 0 1.5px 5px #f3e5f5, 1px 1px 0 #fff;
  }
  .subtitulo {
    color: #9c27b0;
    font-size: 0.85em;
    margin: -5px 0 15px;
    font-weight: 500;
    opacity: 0.85;
  }
  #chat-box {
    width: 100%;
    max-width: 420px;
    height: 60vh;
    background: #fff;
    color: #000;
    border-radius: 12px;
    overflow-y: auto;
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    font-size: 1em;
    scroll-behavior: smooth;
  }
  .user, .lia, .typing {
    margin: 6px 0;
    padding: 12px 18px;
    border-radius: 20px;
    max-width: 75vw;
    word-break: break-word;
    line-height: 1.5;
    box-shadow: 0 2px 7px rgba(0,0,0,0.1);
    user-select: text !important;
  }
  .user {
    background: #8e24aa;
    color: #fff;
    align-self: flex-end;
    font-weight: 600;
    box-shadow: 0 3px 8px #6a1b9aaa;
  }
  .lia {
    background: #f5e1fa;
    color: #3d176a;
    align-self: flex-start;
    box-shadow: 0 3px 8px #c293e4cc;
    position: relative;
  }
  #inputArea {
    margin-top: 12px;
    display: flex;
    width: 100%;
    max-width: 420px;
    gap: 10px;
    padding: 6px 6px 6px 6px;
    border-top: 2px solid #ede7f6;
    background: #fff;
    border-radius: 12px;
  }
  #user-input {
    flex-grow: 1;
    padding: 10px 14px;
    border: 2px solid #8e24aa;
    border-radius: 18px;
    font-size: 1em;
    outline: none;
    background: #f8eaf6;
    color: #4a256b;
  }
  #user-input:focus {
    background: #f3e5f5;
    border-color: #8e24aa;
    color: #3d1747;
  }
  button {
    background: linear-gradient(120deg, #8e24aa 60%, #6a1b9a 100%);
    color: #fff;
    border: none;
    border-radius: 18px;
    padding: 0 18px;
    height: 40px;
    cursor: pointer;
    box-shadow: 0 2px 8px #ce93d8;
    transition: background 0.25s, box-shadow 0.2s;
    user-select: none;
    font-weight: 600;
    font-size: 1em;
  }
  button:hover, button:focus {
    background: linear-gradient(120deg, #6a1b9a 80%, #8e24aa 100%);
    box-shadow: 0 2.5px 10px #8e24aa99;
    outline: none;
  }
  #clear-btn {
    background: linear-gradient(120deg, #d32f2f 60%, #b71c1c 100%);
  }
  #clear-btn:hover,#clear-btn:focus {
    background: linear-gradient(120deg, #b71c1c 80%, #d32f2f 100%);
    box-shadow: 0 2.5px 10px #8e24aa99;
    outline: none;
  }
</style>
</head>
<body>

<h1>Hola, pap√°! Lia aprende contigo üòä</h1>
<div class="subtitulo">Escrib√≠ algo, y si Lia no sabe, me dec√≠s qu√© responder.</div>

<div id="chat-box"></div>

<div id="inputArea">
  <input type="text" id="user-input" placeholder="Escrib√≠ algo..." autocomplete="off" />
  <button id="send-btn" title="Enviar">Enviar</button>
  <button id="clear-btn" title="Limpiar chat y aprendizaje">Limpiar</button>
</div>

<script>
  const chatBox = document.getElementById('chat-box'),
        userInput = document.getElementById('user-input'),
        sendBtn = document.getElementById('send-btn'),
        clearBtn = document.getElementById('clear-btn');

  // Clave en localStorage para guardar el "cerebro" de Lia
  const STORAGE_KEY = 'lia_chat_brain';

  // Estado para saber si estamos pidiendo respuesta para aprender
  let esperandoRespuesta = false;
  let preguntaPendiente = '';

  // Cargar cerebro de Lia o iniciar vac√≠o
  let cerebro = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

  // Funci√≥n para guardar cerebro en localStorage
  function guardarCerebro() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(cerebro));
  }

  // A√±ade mensaje al chat
  function agregarMensaje(texto, clase) {
    const msg = document.createElement('div');
    msg.className = clase;
    msg.textContent = texto;
    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // Procesar mensaje de usuario
  function procesarMensaje(texto) {
    texto = texto.toLowerCase().trim();
    if (esperandoRespuesta) {
      // Estamos aprendiendo: guardamos respuesta para pregunta pendiente
      cerebro[preguntaPendiente] = texto;
      guardarCerebro();
      esperandoRespuesta = false;
      preguntaPendiente = '';
      return '¬°Gracias! He aprendido algo nuevo üòä';
    }

    // Si pregunta ya est√° aprendida, devolver respuesta
    if (cerebro[texto]) {
      return cerebro[texto];
    }

    // Sino, no sabe, pide que ense√±es
    esperandoRespuesta = true;
    preguntaPendiente = texto;
    return 'No entend√≠ muy bien... ¬øC√≥mo deber√≠a responder a eso?';
  }

  // Enviar mensaje y mostrar respuesta
  function enviarMensaje() {
    const texto = userInput.value.trim();
    if (!texto) return;
    agregarMensaje(texto, 'user');
    userInput.value = '';

    // Procesar respuesta con retraso para mejor UX
    setTimeout(() => {
      const respuesta = procesarMensaje(texto);
      agregarMensaje(respuesta, 'lia');
    }, 400);
  }

  // Limpiar chat y cerebro
  clearBtn.addEventListener('click', () => {
    if (confirm('¬øSeguro quer√©s borrar todo el chat y el aprendizaje de Lia?')) {
      localStorage.removeItem(STORAGE_KEY);
      cerebro = {};
      esperandoRespuesta = false;
      preguntaPendiente = '';
      chatBox.innerHTML = '';
    }
  });

  sendBtn.addEventListener('click', enviarMensaje);
  userInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') enviarMensaje();
  });
</script>

</body>
</html>
